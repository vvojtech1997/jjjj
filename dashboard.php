<?php session_start(); require_once 'includes/db_connect.php'; if(empty($_SESSION['user_id'])) header('Location:/login.php'); include 'includes/header_footer.php'; $uid=intval($_SESSION['user_id']); $res=$mysqli->query("SELECT id,plan_data,created_at FROM meal_plans WHERE user_id=$uid ORDER BY id DESC LIMIT 1"); $plan=null; if($res && $row=$res->fetch_assoc()) $plan=json_decode($row['plan_data'],true); ?>
<h2>Môj jedálniček</h2><a class="btn-primary" href="/generate_plan.php">Generovať nový plán</a>
<?php if($plan): foreach($plan as $di=>$meals){ echo '<div class="card"><h4>Deň '.($di+1).'</h4><ul>'; foreach($meals as $m) echo '<li>'.h($m['slot']).' - '.h($m['name']).' ('.h($m['perMealCost']).' €)</li>'; echo '</ul></div>'; } else: ?><p>Zatiaľ žiadny plán.</p><?php endif; include 'includes/footer_bottom.php'; ?>