<?php session_start(); require_once 'includes/db_connect.php'; if(empty($_SESSION['user_id'])) header('Location:/login.php'); $uid=intval($_SESSION['user_id']); if($_SERVER['REQUEST_METHOD']==='POST'){ $name=$mysqli->real_escape_string($_POST['name']??''); $all=$mysqli->real_escape_string($_POST['allergies']??''); $persons=max(1,intval($_POST['persons']??2)); $mysqli->query("UPDATE users SET name='$name',allergies='$all',persons_default=$persons WHERE id=$uid"); $msg='Údaje uložené.'; } $res=$mysqli->query("SELECT email,name,allergies,persons_default FROM users WHERE id=$uid"); $u=$res->fetch_assoc(); include 'includes/header_footer.php'; ?>
<h2>Profil</h2><?php if(!empty($msg)) echo '<p class="info">'.h($msg).'</p>'; ?>
<form method="post"><label>E-mail</label><input value="<?php echo h($u['email']); ?>" disabled><label>Meno</label><input name="name" value="<?php echo h($u['name']); ?>"><label>Alergény</label><input name="allergies" value="<?php echo h($u['allergies']); ?>"><label>Počet osôb</label><input name="persons" type="number" value="<?php echo intval($u['persons_default']); ?>"><button class="btn-primary">Uložiť</button></form>
<?php include 'includes/footer_bottom.php'; ?>